<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KIPO clicker</title>
    <style>
        :root {
            --bg-dark: #1A1A1A;
            --bg-panel: #262626;
            --accent-orange: #FF6B00;
            --accent-light: #FF8C42;
            --accent-dark: #E65100;
            --text-light: #FFFFFF;
            --text-gray: #CCCCCC;
            --tab-orange: #E65100;
            --tab-active: #FF6B00;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-tap-highlight-color: transparent;
        }
        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }
        .header img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        .score {
            color: var(--text-light);
            font-size: 28px;
            font-weight: 800;
        }
        .circle {
            position: relative;
            margin-bottom: 30px;
        }
        .circle img {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
            transition: transform 0.3s ease;
            --tiltX: 0deg;
            --tiltY: 0deg;
            transform: rotateX(var(--tiltX)) rotateY(var(--tiltY));
        }
        .plus-one {
            position: absolute;
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(180deg, #e8c547 0%, #ef882b 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            pointer-events: none;
            user-select: none;
            animation: move-up 2s forwards;
        }
        @keyframes move-up {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        /* Новый стиль для вкладок (на всю ширину) */
        .tabs-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            z-index: 100;
            background-color: var(--bg-panel);
            border-top: 1px solid #333;
        }
        .tab-btn {
            flex: 1;
            padding: 12px 0;
            border: none;
            background-color: var(--tab-orange);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 60px;
        }
        .tab-btn.active {
            background-color: var(--tab-active);
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .tab-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: transparent;
            transition: background-color 0.3s;
        }
        .tab-btn.active::after {
            background-color: var(--accent-light);
        }
        .tab-icon {
            font-size: 24px;
            margin-bottom: 3px;
        }
        .tab-label {
            font-size: 12px;
            font-weight: 500;
        }

        /* Стили для всплывающих панелей */
        .tab-panel {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            max-height: 60vh;
            background-color: var(--bg-panel);
            border-radius: 20px 20px 0 0;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none;
            overflow-y: auto;
            animation: slide-up 0.3s ease-out;
        }
        @keyframes slide-up {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        .tab-panel.active {
            display: block;
        }
        .close-panel {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 24px;
            cursor: pointer;
        }

        /* Стили для поля ввода адреса кошелька */
        .wallet-input-container {
            margin-top: 20px;
            position: relative;
        }
        .wallet-input-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-gray);
        }
        .wallet-input {
            width: 100%;
            padding: 14px 15px;
            border-radius: 12px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
            font-size: 16px;
            font-family: monospace;
            transition: all 0.3s;
        }
        .wallet-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 2px rgba(255, 107, 0, 0.2);
        }
        .wallet-input::placeholder {
            color: #666;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        /* Остальные стили */
        .balance-info {
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(255, 107, 0, 0.1);
            border-radius: 12px;
        }
        .balance-title {
            font-size: 16px;
            color: var(--text-gray);
            margin-bottom: 5px;
        }
        .balance-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-orange);
        }
        
        /* Стили для прогресс-бара */
        .progress-container {
            margin-top: 20px;
        }
        .progress-title {
            font-size: 14px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }
        .progress-bar {
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B00, #FF8C42);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                        rgba(255,255,255,0.1) 0%, 
                        rgba(255,255,255,0.3) 50%, 
                        rgba(255,255,255,0.1) 100%);
            background-size: 200% 100%;
            animation: shine 2s infinite;
        }
        @keyframes shine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Стили для таблицы наград */
        .rewards-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--bg-panel);
            border-radius: 12px;
            overflow: hidden;
        }
        .rewards-table th, .rewards-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        .rewards-table th {
            background-color: #333;
            color: var(--accent-orange);
            font-weight: 500;
        }
        .rewards-table tr:last-child td {
            border-bottom: none;
        }
        .rewards-table tr:hover {
            background-color: #333;
        }
        .reward-achieved {
            color: var(--accent-orange);
            font-weight: 600;
        }
        
        /* Стили для третьей вкладки с картинками */
        .links-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }
        .link-card {
            display: block;
            text-decoration: none;
            color: var(--text-light);
            transition: transform 0.2s;
        }
        .link-card:active {
            transform: scale(0.98);
        }
        .link-image {
            width: 100%;
            border-radius: 12px;
            border: 1px solid #444;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .link-title {
            margin-top: 8px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            color: var(--accent-orange);
        }
        
        .wallet-btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 12px;
            font-size: 16px;
        }
        .connect-btn {
            background-color: var(--accent-orange);
            color: white;
        }
        .connect-btn:active {
            background-color: var(--accent-dark);
            transform: scale(0.98);
        }
        .disconnect-btn {
            background-color: transparent;
            color: var(--accent-orange);
            border: 2px solid var(--accent-orange);
        }
        .disconnect-btn:active {
            background-color: rgba(255, 107, 0, 0.1);
        }
        .save-btn {
            background-color: #ffa600;
            color: white;
        }
        .save-btn:active {
            background-color: #ffd000;
            transform: scale(0.98);
        }
        .hidden {
            display: none;
        }
        @media (max-width: 350px) {
            .circle img {
                width: 180px;
                height: 180px;
            }
            .tab-icon {
                font-size: 22px;
            }
            .tab-label {
                font-size: 11px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="game-container">
        <div class="header">
            <img src="./assets/cooin.png" alt="coin">
            <div class="score" id="score">0</div>
        </div>
        <div class="circle">
            <img id="circle" src="./assets/Crypto.png" alt="Криптокошелек">
        </div>
    </div>

    <!-- Кнопки вкладок -->
    <div class="tabs-container">
        <button class="tab-btn" data-tab="wallet">
            <span class="material-icons tab-icon">account_balance_wallet</span>
            <span class="tab-label">Кошелек</span>
        </button>
        <button class="tab-btn" data-tab="profile">
            <span class="material-icons tab-icon">emoji_events</span>
            <span class="tab-label">Награды</span>
        </button>
        <button class="tab-btn" data-tab="links">
            <span class="material-icons tab-icon">link</span>
            <span class="tab-label">Ссылки</span>
        </button>
    </div>

    <!-- Всплывающая панель кошелька -->
    <div id="walletPanel" class="tab-panel">
        <button class="close-panel">&times;</button>
        <h2 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <span class="material-icons">account_balance_wallet</span>
            <span>Криптокошелек</span>
        </h2>
        <div class="wallet-status">
            <p id="walletStatusText">Кошелек не подключен</p>
            <p id="walletAddress" class="hidden"></p>
        </div>
        <button id="connectWalletBtn" class="wallet-btn connect-btn">
            <span class="material-icons" style="vertical-align: middle; margin-right: 5px;">link</span>
            Подключить
        </button>
        <button id="disconnectWalletBtn" class="wallet-btn disconnect-btn hidden">
            <span class="material-icons" style="vertical-align: middle; margin-right: 5px;">link_off</span>
            Отключить
        </button>
        
        <div class="wallet-input-container">
            <label for="manualWalletInput" class="wallet-input-label">Или введите адрес вручную:</label>
            <input type="text" id="manualWalletInput" class="wallet-input" placeholder="0x...">
            <button id="saveManualWalletBtn" class="wallet-btn connect-btn" style="margin-top: 10px;">
                <span class="material-icons" style="vertical-align: middle; margin-right: 5px;">save</span>
                Сохранить адрес
            </button>
        </div>
    </div>

    <!-- Всплывающая панель наград -->
    <div id="profilePanel" class="tab-panel">
        <button class="close-panel">&times;</button>
        <h2 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <span class="material-icons">emoji_events</span>
            <span>Ваши награды</span>
        </h2>
        
        <div class="balance-info">
            <div class="balance-title">Ваш баланс</div>
            <div class="balance-value" id="totalBalance">0 монет</div>
        </div>
        
        <div class="progress-container">
            <div class="progress-title">
                <span>Прогресс до следующей награды</span>
                <span id="progressValue">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>
        
        <table class="rewards-table">
            <thead>
                <tr>
                    <th>Количество монет</th>
                    <th>Награда</th>
                </tr>
            </thead>
            <tbody>
                <tr id="reward1">
                    <td>30 000 - 50 000</td>
                    <td>0.1 балла к аттестату</td>
                </tr>
                <tr id="reward2">
                    <td>50 000 - 100 000</td>
                    <td>0.2 балла к аттестату</td>
                </tr>
                <tr id="reward3">
                    <td>100 000+</td>
                    <td>0.3 балла к аттестату</td>
                </tr>
                <tr id="reward4">
                    <td>500 000+</td>
                    <td>Скидка 5% на обучение + 0.3 балла</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Всплывающая панель ссылок -->
    <div id="linksPanel" class="tab-panel">
        <button class="close-panel">&times;</button>
        <h2 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <span class="material-icons">link</span>
            <span>Полезные ссылки</span>
        </h2>
        
        <div class="links-container">
            <a href="https://t.me/kipokrd" target="_blank" class="link-card">
                <img src="./assets/KIPOttt.jpg" alt="Телеграм канал" class="link-image">
                <div class="link-title">Наша учебная жизнь</div>
            </a>
            
            <a href="https://vkipo.ru/incoming/submission_documents/" target="_blank" class="link-card">
                <img src="./assets/KIPOhh.jpg" alt="Сайт KIPO" class="link-image">
                <div class="link-title">Подать документы в наше учебное учреждение</div>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы игры
            const $circle = document.querySelector('#circle');
            const $score = document.querySelector('#score');
            const $totalBalance = document.querySelector('#totalBalance');

            // Элементы прогресса
            const $progressFill = document.getElementById('progressFill');
            const $progressValue = document.getElementById('progressValue');
            
            // Элементы наград
            const $reward1 = document.getElementById('reward1');
            const $reward2 = document.getElementById('reward2');
            const $reward3 = document.getElementById('reward3');
            const $reward4 = document.getElementById('reward4');

            // Элементы кошелька
            const $connectWalletBtn = document.querySelector('#connectWalletBtn');
            const $disconnectWalletBtn = document.querySelector('#disconnectWalletBtn');
            const $walletStatusText = document.querySelector('#walletStatusText');
            const $walletAddress = document.querySelector('#walletAddress');
            const $manualWalletInput = document.querySelector('#manualWalletInput');
            const $saveManualWalletBtn = document.querySelector('#saveManualWalletBtn');

            // Элементы вкладок
            const $tabButtons = document.querySelectorAll('.tab-btn');
            const $tabPanels = document.querySelectorAll('.tab-panel');
            const $closeButtons = document.querySelectorAll('.close-panel');

            // Текущая активная панель
            let activePanel = null;

            // Инициализация игры
            function initGame() {
                setScore(getScore());
                updateTotalBalance();
                updateProgress();
                updateRewards();
            }

            // Функции игры
            function setScore(score) {
                localStorage.setItem('score', score);
                $score.textContent = score;
                updateTotalBalance();
                updateProgress();
                updateRewards();
            }

            function getScore() {
                return Number(localStorage.getItem('score')) || 0;
            }

            function updateTotalBalance() {
                const total = getTotalCoins();
                $totalBalance.textContent = `${total} монет`;
            }

            function getTotalCoins() {
                return Number(localStorage.getItem('totalCoins')) || getScore();
            }

            function addOne() {
                const newScore = getScore() + 1;
                setScore(newScore);
                // Обновляем общее количество монет
                const totalCoins = getTotalCoins() + 1;
                localStorage.setItem('totalCoins', totalCoins);
                updateTotalBalance();
            }
            
            // Обновление прогресс-бара
            function updateProgress() {
                const totalCoins = getTotalCoins();
                let progress = 0;
                let nextMilestone = 30000;
                
                if (totalCoins < 30000) {
                    progress = totalCoins / 30000 * 100;
                    nextMilestone = 30000;
                } else if (totalCoins < 50000) {
                    progress = (totalCoins - 30000) / 20000 * 100;
                    nextMilestone = 50000;
                } else if (totalCoins < 100000) {
                    progress = (totalCoins - 50000) / 50000 * 100;
                    nextMilestone = 100000;
                } else if (totalCoins < 500000) {
                    progress = (totalCoins - 100000) / 400000 * 100;
                    nextMilestone = 500000;
                } else {
                    progress = 100;
                    nextMilestone = "максимум";
                }
                
                $progressFill.style.width = `${progress}%`;
                $progressValue.textContent = `${Math.round(progress)}%`;
            }
            
            // Обновление статуса наград
            function updateRewards() {
                const totalCoins = getTotalCoins();
                
                // Сброс всех классов
                $reward1.classList.remove('reward-achieved');
                $reward2.classList.remove('reward-achieved');
                $reward3.classList.remove('reward-achieved');
                $reward4.classList.remove('reward-achieved');
                
                // Проверка достижений
                if (totalCoins >= 30000) {
                    $reward1.classList.add('reward-achieved');
                }
                if (totalCoins >= 50000) {
                    $reward2.classList.add('reward-achieved');
                }
                if (totalCoins >= 100000) {
                    $reward3.classList.add('reward-achieved');
                }
                if (totalCoins >= 500000) {
                    $reward4.classList.add('reward-achieved');
                }
            }

            // Обработчик клика по кругу
            $circle.addEventListener('click', (event) => {
                const rect = $circle.getBoundingClientRect();
                const offsetX = event.clientX - rect.left - rect.width / 2;
                const offsetY = event.clientY - rect.top - rect.height / 2;
                const DEG = 40;
                const tiltX = (offsetY / rect.height) * DEG;
                const tiltY = (offsetX / rect.width) * -DEG;

                $circle.style.setProperty('--tiltX', `${tiltX}deg`);
                $circle.style.setProperty('--tiltY', `${tiltY}deg`);

                setTimeout(() => {
                    $circle.style.setProperty('--tiltX', `0deg`);
                    $circle.style.setProperty('--tiltY', `0deg`);
                }, 300);

                const plusOne = document.createElement('div');
                plusOne.classList.add('plus-one');
                plusOne.textContent = '+1';
                plusOne.style.left = `${event.clientX - rect.left}px`;
                plusOne.style.top = `${event.clientY - rect.top}px`;
                $circle.parentElement.appendChild(plusOne);

                addOne();

                setTimeout(() => {
                    plusOne.remove();
                }, 2000);
            });

            // Функции кошелька
            function connectWallet() {
                if (window.ethereum) {
                    $connectWalletBtn.textContent = 'Подключение...';
                    window.ethereum.request({ method: 'eth_requestAccounts' })
                        .then(accounts => {
                            const walletData = {
                                address: accounts[0],
                                connectedAt: new Date().toISOString()
                            };
                            localStorage.setItem('wallet', JSON.stringify(walletData));
                            updateWalletUI(walletData);
                            $walletStatusText.textContent = 'Успешное подключение!';
                        })
                        .catch(error => {
                            console.error('Ошибка подключения:', error);
                            $walletStatusText.textContent = 'Подключение отменено';
                        })
                        .finally(() => {
                            $connectWalletBtn.innerHTML = '<span class="material-icons" style="vertical-align: middle; margin-right: 5px;">link</span>Подключить';
                        });
                } else {
                    $walletStatusText.textContent = 'Установите MetaMask или другой кошелек';
                }
            }

            function disconnectWallet() {
                localStorage.removeItem('wallet');
                resetWalletUI();
                $walletStatusText.textContent = 'Кошелек отключен';
            }

            function updateWalletUI(walletData) {
                const shortAddress = `${walletData.address.substring(0, 6)}...${walletData.address.substring(walletData.address.length - 4)}`;
                $walletAddress.textContent = shortAddress;
                $walletAddress.classList.remove('hidden');
                $connectWalletBtn.classList.add('hidden');
                $disconnectWalletBtn.classList.remove('hidden');
            }

            function resetWalletUI() {
                $walletAddress.textContent = '';
                $walletAddress.classList.add('hidden');
                $connectWalletBtn.classList.remove('hidden');
                $disconnectWalletBtn.classList.add('hidden');
            }

            function checkSavedWallet() {
                const savedWallet = localStorage.getItem('wallet');
                if (savedWallet) {
                    updateWalletUI(JSON.parse(savedWallet));
                }
            }

            $connectWalletBtn.addEventListener('click', connectWallet);
            $disconnectWalletBtn.addEventListener('click', disconnectWallet);

            // Ручное сохранение кошелька
            $saveManualWalletBtn.addEventListener('click', function() {
                const address = $manualWalletInput.value.trim();
                if (!address) {
                    showAlert('Введите адрес кошелька!');
                    return;
                }
                if (!/^0x[a-fA-F0-9]{40}$/.test(address)) {
                    showAlert('Неверный формат адреса!');
                    return;
                }

                const walletData = {
                    address: address,
                    connectedAt: new Date().toISOString(),
                    type: 'manual'
                };
                localStorage.setItem('wallet', JSON.stringify(walletData));
                updateWalletUI(walletData);
                $manualWalletInput.value = '';
                showAlert('Кошелек сохранен!', 'success');
            });

            // Управление вкладками
            function openPanel(panelId) {
                // Закрываем текущую панель, если есть
                if (activePanel) {
                    activePanel.classList.remove('active');
                    document.querySelector(`.tab-btn[data-tab="${activePanel.id.replace('Panel', '')}"]`).classList.remove('active');
                }

                // Открываем новую панель
                const panel = document.getElementById(panelId);
                panel.classList.add('active');
                document.querySelector(`.tab-btn[data-tab="${panelId.replace('Panel', '')}"]`).classList.add('active');
                activePanel = panel;
            }

            function closeAllPanels() {
                $tabPanels.forEach(panel => panel.classList.remove('active'));
                $tabButtons.forEach(btn => btn.classList.remove('active'));
                activePanel = null;
            }

            // Обработчики для кнопок вкладок
            $tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const panelId = `${tabId}Panel`;
                    if (activePanel && activePanel.id === panelId) {
                        closeAllPanels();
                    } else {
                        openPanel(panelId);
                    }
                });
            });

            // Обработчики для кнопок закрытия
            $closeButtons.forEach(btn => {
                btn.addEventListener('click', closeAllPanels);
            });

            // Закрытие при клике вне панели
            document.addEventListener('click', function(e) {
                if (activePanel && !activePanel.contains(e.target)) {
                    const isTabButton = Array.from($tabButtons).some(btn => btn.contains(e.target));
                    if (!isTabButton) {
                        closeAllPanels();
                    }
                }
            });

            // Всплывающие уведомления
            function showAlert(message, type = 'error') {
                const alert = document.createElement('div');
                alert.textContent = message;
                alert.style.position = 'fixed';
                alert.style.bottom = '20px';
                alert.style.left = '50%';
                alert.style.transform = 'translateX(-50%)';
                alert.style.padding = '12px 24px';
                alert.style.borderRadius = '8px';
                alert.style.backgroundColor = type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3';
                alert.style.color = 'white';
                alert.style.zIndex = '1001';
                alert.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                alert.style.animation = 'fadeIn 0.3s ease-out';
                document.body.appendChild(alert);

                setTimeout(() => {
                    alert.style.animation = 'fadeIn 0.3s ease-out reverse';
                    setTimeout(() => alert.remove(), 300);
                }, 3000);
            }

            // Инициализация
            initGame();
            checkSavedWallet();

            // Отслеживание изменений аккаунта
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length === 0) {
                        disconnectWallet();
                    } else {
                        const walletData = {
                            address: accounts[0],
                            connectedAt: new Date().toISOString()
                        };
                        localStorage.setItem('wallet', JSON.stringify(walletData));
                        updateWalletUI(walletData);
                    }
                });
            }
        });
    </script>
</body>
</html>
